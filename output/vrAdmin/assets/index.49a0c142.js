var fe=Object.defineProperty,De=Object.defineProperties;var xe=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var ge=Object.prototype.hasOwnProperty,Be=Object.prototype.propertyIsEnumerable;var J=(s,a,t)=>a in s?fe(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t,E=(s,a)=>{for(var t in a||(a={}))ge.call(a,t)&&J(s,t,a[t]);if(W)for(var t of W(a))Be.call(a,t)&&J(s,t,a[t]);return s},C=(s,a)=>De(s,xe(a));import{R as e,bt as h,aG as we,r as l,ba as K,cT as Se,n as be,bl as X,bm as $,B as k,bh as Ae,bn as Ce,a as Te,cU as ke,cV as Ie,cW as Le,cX as ve,bs as Ue,T as Y,H as Me}from"./index.d85f42cd.js";import"./index.72710f81.js";import{P as ee}from"./Table.24a195f9.js";import{S as Re,T as Oe}from"./shop-list.39898b47.js";import{F as Pe}from"./index.9188d624.js";import{S as Ne,U as Ve,I as qe,b as U,c as Z,d as M,e as T,f as B,P as i,a as H}from"./common.9f7dcf02.js";import{w as Q}from"./index.4735b534.js";import{P as Ge}from"./ProCard.79118da3.js";import{U as je}from"./index.3f2017e0.js";import{P as _e}from"./index.9a267f19.js";import{P as R}from"./index.b9c967ff.js";import{P as w}from"./index.933c4a53.js";function ze(s,a){const t=new FileReader;t.addEventListener("load",()=>a(t.result)),t.readAsDataURL(s)}function We(s){const a=s.type==="image/jpeg"||s.type==="image/png";a||h.error("You can only upload JPG/PNG file!");const t=s.size/1024/1024<2;return t||h.error("Image must smaller than 2MB!"),a&&t}class Je extends e.Component{constructor(){super(...arguments),this.state={loading:!1},this.handleChange=a=>{if(a.file.status==="uploading"){this.setState({loading:!0});return}a.file.status==="done"&&ze(a.file.originFileObj,t=>this.setState({imageUrl:t,loading:!1}))}}render(){const{loading:a,imageUrl:t}=this.state,c=e.createElement("div",null,a?e.createElement(we,null):e.createElement(_e,null),e.createElement("div",{style:{marginTop:8}},"\u4E0A\u4F20"));return e.createElement(je,{name:"file",listType:"picture-card",className:"avatar-uploader",showUploadList:!1,action:"/api/v1/app/file/upload",beforeUpload:We,onChange:this.handleChange},t?e.createElement("img",{src:t,alt:"avatar",style:{width:"100%"}}):c)}}const Ke={labelCol:{span:4},wrapperCol:{span:20}},Ye=s=>{const a=l.exports.useRef(null),[t]=K.useForm(),{visible:c,current:d={},onCancel:I,onSubmit:S}=s,{data:L,error:f,isLoading:v,refetch:F}=Se(),[b,p]=l.exports.useState();l.exports.useEffect(()=>{var x;const o=(x=L.data)==null?void 0:x.map(m=>({value:m==null?void 0:m.id,label:m==null?void 0:m.name}));p(o)},[L]),l.exports.useEffect(()=>{a.current&&(c||t.resetFields())},[a,c]),l.exports.useEffect(()=>{d&&t.setFieldsValue(C(E({},d),{createdAt:d.createdAt?be(d.createdAt):null}))},[d]);const N=()=>{if(!t)return;const o=t.getFieldsValue();t.setFieldsValue(E({},o)),t.submit()},V=async o=>{S&&S(o)},D=()=>e.createElement(K,C(E({},Ke),{form:t,ref:a,onFinish:V}),e.createElement(Ge,{title:"\u57FA\u672C\u4FE1\u606F",bordered:!0,headerBordered:!0,collapsible:!0,style:{marginBottom:16,minWidth:200,maxWidth:"100%"}},e.createElement(w,{key:"username",name:"username",width:"md",label:"\u7528\u6237\u6635\u79F0",tooltip:"\u6700\u957F\u4E3A24\u4F4D",placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u6635\u79F0",rules:[{required:!0}]}),e.createElement(w,{key:"realName",name:"realName",width:"md",label:"\u771F\u5B9E\u59D3\u540D",tooltip:"\u6700\u957F\u4E3A24\u4F4D",placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u59D3\u540D",rules:[{required:!0}]}),e.createElement(R,{key:"sex",name:"sex",label:"\u6027\u522B",width:"md",options:Ne,placeholder:"\u9009\u62E9\u6027\u522B"}),e.createElement(R,{key:"status",name:"status",label:"\u72B6\u6001",width:"md",options:Ve,placeholder:"\u9009\u62E9\u8D26\u53F7\u72B6\u6001"}),e.createElement(w,{key:"companyName",name:"companyName",width:"md",label:"\u516C\u53F8\u540D\u79F0",tooltip:"\u6700\u957F\u4E3A24\u4F4D",placeholder:"\u8BF7\u8F93\u5165\u516C\u53F8\u540D\u79F0",rules:[{required:!0}]}),e.createElement(w,{key:"attention",name:"attention",width:"md",label:"\u5173\u6CE8\u9886\u57DF",tooltip:"\u6700\u957F\u4E3A24\u4F4D",placeholder:"\u8BF7\u8F93\u5165\u5173\u6CE8\u9886\u57DF",rules:[{required:!0}]}),e.createElement(w,{key:"remark",name:"remark",width:"md",label:"\u7528\u9014\u8BF4\u660E",placeholder:"\u8BF7\u8F93\u5165\u7528\u9014",rules:[{required:!0}]}),e.createElement(w,{key:"imgUrl",name:"imgUrl",label:"\u5934\u50CF\u8BBE\u7F6E"},e.createElement(Je,null)),e.createElement(R,{key:"identityType",name:"identityType",label:"\u8D26\u53F7\u7C7B\u578B",width:"md",options:qe,placeholder:"\u9009\u62E9\u8D26\u53F7\u7C7B\u578B"}),e.createElement(R,{key:"roleId",name:"roleId",label:"\u89D2\u8272",width:"md",options:b,placeholder:"\u9009\u62E9\u89D2\u8272"})),e.createElement(Re,{filterType:""}));return e.createElement(X,{title:`\u7528\u6237${d?"\u7F16\u8F91":"\u6DFB\u52A0"}`,width:800,onClose:I,visible:c,bodyStyle:{paddingBottom:0},extra:e.createElement($,null,e.createElement(k,{onClick:I},"\u53D6\u6D88"),e.createElement(k,{onClick:N,type:"primary"},"\u4FDD\u5B58"))},D())},Ze=s=>{const{apps:a}=s,t=[{key:"appId",title:"\u95E8\u5E97\u7F16\u53F7",dataIndex:"appId",valueType:"text",width:120},{key:"nm",title:"\u95E8\u5E97\u540D\u79F0",dataIndex:"nm",valueType:"text",ellipsis:!0,width:150},{key:"code",title:"\u95E8\u5E97\u7F16\u7801",dataIndex:"code",valueType:"text",width:140},{key:"province",title:"\u7701",dataIndex:"province",valueType:"text",width:100},{key:"city",title:"\u5E02",dataIndex:"city",valueType:"text",width:100},{key:"district",title:"\u533A",dataIndex:"district",valueType:"text",width:100},{key:"address",title:"\u8BE6\u7EC6\u5730\u5740",dataIndex:"address",valueType:"textarea",width:100},{title:"\u72B6\u6001",width:80,dataIndex:"status",valueEnum:{[U.NORMAL]:{text:Z.get(U.NORMAL)},[U.DISABLED]:{text:Z.get(U.DISABLED)}}},{title:"\u95E8\u5E97\u8BC4\u7EA7",dataIndex:"grade",valueType:"rate",width:200},{title:"\u5408\u4F19\u4EBA",dataIndex:"partner",valueType:"text",with:120}];return e.createElement(ee,{rowKey:"appId",headerTitle:"\u95E8\u5E97\u6743\u9650\u5217\u8868",scroll:{x:1300},options:{reload:!1},request:void 0,dataSource:a,columns:t,search:!1,hideOnSinglePage:!0,tableAlertOptionRender:!1,defaultSize:"small"})},He=s=>{const{visible:a,current:t={},onClose:c}=s,{apps:d=[]}=t;return e.createElement(X,{className:"storeDrawer",title:"\u67E5\u770B\u6570\u636E\u6743\u9650",width:700,onClose:c,visible:a,bodyStyle:{paddingBottom:80}},e.createElement(Ze,{apps:d}))},ct=s=>{const{isAssociate:a}=s,t=Ae(Ce),{formatMessage:c}=Te(),[d,I]=l.exports.useState(),[S,L]=l.exports.useState(),[f,v]=l.exports.useState(void 0),[F,b]=l.exports.useState({current:1,pageSize:10,total:0}),{data:p,error:N,isLoading:V,refetch:D}=ke(F,S),[o,x]=l.exports.useState([]),[m,Qe]=l.exports.useState(!1),[te,A]=l.exports.useState(!1),[ae,q]=l.exports.useState(!1),ue=l.exports.useRef(),G=l.exports.useRef(null),{mutateAsync:se}=Ie(),{mutateAsync:re}=Le(),{mutateAsync:ne}=ve();l.exports.useEffect(()=>{I(p==null?void 0:p.data),b(C(E({},F),{total:p==null?void 0:p.total,showQuickJumper:!0}))},[p]),l.exports.useEffect(()=>{D()},[F.current,F.pageSize,S]);const le=()=>{A(!0),v(void 0)},oe=u=>{A(!0),v(u)},ie=u=>{q(!0),v(u)},de=()=>{q(!1)},O=()=>{if(G.current){const u=Me.exports.findDOMNode(G.current);setTimeout(()=>u.blur(),0)}},ce=()=>{O(),A(!1)},pe=()=>{O(),A(!1)},me=async u=>{await se(u)},Ee=async u=>{await re(u)},he=async u=>{u.id=f&&f.id?f.id:0,O(),A(!1);const r=h.loading("\u6B63\u5728\u6DFB\u52A0/\u66F4\u65B0");try{return u.id===0?await me(u):await Ee(u),r(),h.success("\u64CD\u4F5C\u6210\u529F"),D(),!0}catch{return r(),h.error("\u64CD\u4F5C\u5931\u8D25\u8BF7\u91CD\u8BD5\uFF01"),!1}},j=async u=>{var n;const r=h.loading("\u6B63\u5728\u5220\u9664");if(!u)return!0;try{const y=((n=u.map(ye=>ye.id))!=null?n:[]).join(",");return await ne({ids:y}),b(C(E({},F),{current:1})),r(),h.success("\u5220\u9664\u6210\u529F\uFF0C\u5373\u5C06\u5237\u65B0"),!0}catch{return r(),h.error("\u5220\u9664\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5"),!1}};function Fe(u){return e.createElement("a",E({},u),u.children)}const _=Q(Fe,t),z=Q(k,t);let g=[{title:"\u7528\u6237\u6635\u79F0",dataIndex:"imageUrl",key:"imageUrl",valueType:"avatar",width:150,render:(u,r,n,P)=>e.createElement($,null,e.createElement("span",null,u),e.createElement("span",null,r.username))},{title:"\u7528\u6237\u59D3\u540D",dataIndex:"realName",ellipsis:!0,width:120},{title:"\u6027\u522B",width:80,dataIndex:"sex",valueEnum:{[M.MALE]:{text:T.get(M.MALE)},[M.FEMALE]:{text:T.get(M.FEMALE)}}},{title:"\u624B\u673A\u53F7",dataIndex:"mobile"},{title:a?"\u5173\u8054\u4EBA\u89D2\u8272":"\u89D2\u8272",dataIndex:"roleNm",valueType:"text",with:100},{title:"\u72B6\u6001",width:120,dataIndex:"status",initialValue:"all",valueEnum:{[B.NORMAL]:{text:T.get(B.NORMAL),status:"Success"},[B.FREEZE]:{text:T.get(B.FREEZE),status:"Error"},[B.DISABLED]:{text:T.get(B.NORMAL),status:"Default"}}}];return a?g=g.concat([{title:"\u95E8\u5E97ID",dataIndex:"appId",valueType:"text"},{title:"\u95E8\u5E97\u6570\u91CF",dataIndex:"appNums",valueType:"text",render:(u,r)=>{var n;return e.createElement("span",{className:"appNums"},(n=r==null?void 0:r.apps)==null?void 0:n.length)}},{title:"\u521D\u6B21\u7B7E\u7EA6\u65F6\u95F4",width:180,dataIndex:"tm",valueType:"dateTime"}]):g=g.concat([{title:"\u4E0A\u6B21\u767B\u9646IP",width:140,dataIndex:"loginIp",valueType:"text",hideInSearch:!0},{title:"\u4E0A\u6B21\u767B\u9646\u65F6\u95F4",width:180,key:"showTime",dataIndex:"loginDate",valueType:"dateTime",ellipsis:!0,hideInSearch:!0}]),g.push({title:c({id:"gloabal.tips.operation"}),dataIndex:"option",key:"option",valueType:"option",fixed:"right",width:200,render:(u,r)=>{const n=[];return i.DELETE&&n.push({key:i.DELETE,name:"\u5220\u9664"}),[e.createElement(_,{key:i.EDIT,operCode:i.EDIT,onClick:y=>{y.preventDefault(),oe(r)}},"\u7F16\u8F91"),e.createElement(_,{key:i.LIST,operCode:i.LIST,onClick:y=>{y.preventDefault(),ie(r)}},"\u67E5\u770B\u6570\u636E\u6743\u9650"),e.createElement(Oe,{key:"actionGroup",onSelect:y=>{y===i.DELETE&&Ue.confirm({title:"\u5220\u9664\u7528\u6237",content:"\u786E\u5B9A\u5220\u9664\u8BE5\u7528\u6237\u5417\uFF1F",okText:"\u786E\u8BA4",cancelText:"\u53D6\u6D88",onOk:async()=>{await j([E({},r)]),x([]),D()}})},menus:n})]}}),e.createElement(e.Fragment,null,e.createElement(ee,{rowKey:"id",headerTitle:"\u7528\u6237\u7BA1\u7406",actionRef:ue,scroll:{x:1300},options:{reload:!1},toolBarRender:()=>[e.createElement(z,{type:"primary",key:"primary",onClick:le,operCode:i.ADD},H.get(i.ADD))],request:void 0,dataSource:d,columns:g,pagination:F,onChange:(u,r,n)=>{b(u)},rowSelection:{onChange:(u,r)=>{x(r)}},search:{defaultCollapsed:!1,optionRender:({searchText:u,resetText:r},{form:n})=>[e.createElement(k,{key:"search",type:"primary",onClick:()=>{console.log("search submit"),L(n==null?void 0:n.getFieldsValue())}},u),e.createElement(k,{key:"reset",onClick:()=>{n==null||n.resetFields()}},r)]}}),(o==null?void 0:o.length)>0&&e.createElement(Pe,{extra:e.createElement("div",null,e.createElement(Y,{id:"app.project.chosen",defaultMessage:"\u5DF2\u9009\u62E9"})," ",e.createElement("a",{style:{fontWeight:600}},o.length)," ",e.createElement(Y,{id:"app.project.item",defaultMessage:"\u9879"}))},e.createElement(z,{type:"primary",key:"primary",onClick:async()=>{await j(o),x([]),D()},operCode:i.DELETE},H.get(i.DELETE)),","),e.createElement(Ye,{done:m,current:f,visible:te,onDone:ce,onCancel:pe,onSubmit:he}),e.createElement(He,{current:f,visible:ae,onClose:de}))};export{ct as U};
