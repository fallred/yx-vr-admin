var ue=Object.defineProperty,ce=Object.defineProperties;var le=Object.getOwnPropertyDescriptors;var U=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var Y=(r,o,n)=>o in r?ue(r,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[o]=n,h=(r,o)=>{for(var n in o||(o={}))ie.call(o,n)&&Y(r,n,o[n]);if(U)for(var n of U(o))de.call(o,n)&&Y(r,n,o[n]);return r},A=(r,o)=>ce(r,le(o));import{R as e,ar as me,bg as $,aG as pe,bh as ne,bi as Ee,r as t,bj as fe,bk as he,ba as X,n as Fe,bl as ye,bm as De,B as R,bn as xe,a as Ce,bo as Se,bp as ge,bq as Te,br as ke,bs as be,T as Z,bt as L,H as Be}from"./index.d85f42cd.js";import"./index.72710f81.js";import{P as Ae}from"./Table.24a195f9.js";import{P as Le,F as Ke}from"./index.9188d624.js";import{P as D,a as ee}from"./common.9f7dcf02.js";import{w as te}from"./index.4735b534.js";import{T as we}from"./index.f455c3e5.js";import"./index.d8dd6c9b.js";import{P as J}from"./index.933c4a53.js";import{P as Me}from"./index.700eaf91.js";import"./index.0647d1d5.js";import"./index.9a267f19.js";import"./index.743b3e30.js";import"./toString.c4f06f52.js";import"./index.eea1bc09.js";import"./Pagination.08be496f.js";import"./index.bc2518e5.js";import"./index.77010c15.js";import"./index.bb0a0649.js";const Re=e.createElement(pe,{style:{fontSize:24},spin:!0});function Pe(r){return function(n){return n.isLoading?e.createElement(e.Fragment,null,e.createElement(me,{indicator:Re}),"\u52A0\u8F7D\u4E2D..."):!n.isLoading&&n.list.length===0?e.createElement($,{image:$.PRESENTED_IMAGE_SIMPLE}):e.createElement(r,h({},n))}}const _e="_container_qh0jx_5",ve="_menuTree_qh0jx_8",Ne="_funcTree_qh0jx_15";var W={container:_e,menuTree:ve,funcTree:Ne};const Ie=r=>{const{leftCheckedKeys:o,rightCheckedKeys:n,cRef:x}=r,u=ne(Ee),[C,E]=t.exports.useState([]),[T,d]=t.exports.useState([]),[S,m]=t.exports.useState([]),[k,F]=t.exports.useState([]),[P,b]=t.exports.useState(!0),[f,y]=t.exports.useState([]),[g,l]=t.exports.useState([]),[K,H]=t.exports.useState([]),[B,I]=t.exports.useState(!0),_=Pe(we),v=a=>{const p=he("",u,a);E(p)},q=a=>{console.log("onExpand",a),d(a),b(!1)},O=(a,p)=>{console.log("onCheck",a),m(a);const N=p.halfCheckedKeys.concat(a);v(N)},w=(a,p)=>{console.log("onSelect",p),F(a)},j=a=>{console.log("onExpand1",a),y(a),I(!1)},z=(a,p)=>{console.log("onCheck",a),l(a)},G=(a,p)=>{console.log("onSelect",p),H(a)};return t.exports.useImperativeHandle(x,()=>({getValue:()=>fe(u,S,g)})),t.exports.useEffect(()=>{m(o),v(o)},[o]),t.exports.useEffect(()=>{l(n)},[n]),e.createElement("div",{className:W.container},e.createElement("div",{key:"authTree1",className:W.menuTree},e.createElement(_,{list:u,checkable:!0,onExpand:q,expandedKeys:T,autoExpandParent:P,onCheck:O,checkedKeys:S,onSelect:w,selectedKeys:k,treeData:u,fieldNames:{title:"menuName",key:"menuId",children:"children"}})),e.createElement("div",{key:"authTree2",className:W.funcTree},e.createElement(_,{list:C,checkable:!0,onExpand:j,expandedKeys:f,autoExpandParent:B,onCheck:z,checkedKeys:g,onSelect:G,selectedKeys:K,treeData:C,fieldNames:{title:"menuName",key:"id",children:"children"}})))},qe={labelCol:{span:4},wrapperCol:{span:20}},Oe=r=>{const o=t.exports.useRef(null),[n]=X.useForm(),{visible:x,current:u={},onCancel:C,onSubmit:E}=r,{selectedMenuTree:T}=u,[d,S]=t.exports.useState([]),[m,k]=t.exports.useState([]),F=t.exports.useRef(null);t.exports.useEffect(()=>{o.current&&(x||n.resetFields())},[o,x]),t.exports.useEffect(()=>{u&&n.setFieldsValue(A(h({},u),{createdAt:u.createdAt?Fe(u.createdAt):null}))},[u]),t.exports.useEffect(()=>{},[T]);const P=()=>{var K;if(!n)return;const y=n.getFieldsValue(),g=(K=F==null?void 0:F.current)==null?void 0:K.getValue(),l=g?JSON.stringify(g):"[]";n.setFieldsValue(A(h({},y),{powerSelected:l})),n.submit()},b=async y=>{E&&E(y)},f=()=>e.createElement(X,A(h({},qe),{form:n,ref:o,onFinish:b}),e.createElement(J,{name:"name",label:"\u89D2\u8272\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0"}]}),e.createElement(J,{name:"code",label:"\u89D2\u8272\u7F16\u7801",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u89D2\u8272\u7F16\u7801"}]}),e.createElement(Me,{name:"comment",label:"\u89D2\u8272\u63CF\u8FF0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u89D2\u8272\u63CF\u8FF0"}]}),e.createElement(J,{name:"powerSelected",label:"\u6743\u9650\u83DC\u5355"},e.createElement(Ie,{cRef:F,leftCheckedKeys:d,rightCheckedKeys:m})));return e.createElement(ye,{title:`\u89D2\u8272${u?"\u7F16\u8F91":"\u6DFB\u52A0"}`,width:800,onClose:C,visible:x,bodyStyle:{paddingBottom:80},extra:e.createElement(De,null,e.createElement(R,{onClick:C},"\u53D6\u6D88"),e.createElement(R,{onClick:P,type:"primary"},"\u4FDD\u5B58"))},f())},ut=()=>{const r=ne(xe),{formatMessage:o}=Ce(),[n,x]=t.exports.useState(),[u,C]=t.exports.useState(),[E,T]=t.exports.useState(void 0),[d,S]=t.exports.useState({current:1,pageSize:10,total:0}),[m,k]=t.exports.useState([]),[F,P]=t.exports.useState(!1),[b,f]=t.exports.useState(!1),y=t.exports.useRef(null),g=t.exports.useRef(),{data:l,error:K,isLoading:H,refetch:B}=Se(d,u),{mutateAsync:I}=ge(),{mutateAsync:_}=Te(),{mutateAsync:v}=ke();t.exports.useEffect(()=>{x(l==null?void 0:l.data),S(A(h({},d),{total:l==null?void 0:l.total,showQuickJumper:!0}))},[l]),t.exports.useEffect(()=>{B()},[d.current,d.pageSize,u]);const q=()=>{f(!0),T(void 0)},O=s=>{f(!0),s.selectedMenuTree=JSON.parse(s.powerSelected),T(s)},w=()=>{if(y.current){const s=Be.exports.findDOMNode(y.current);setTimeout(()=>s.blur(),0)}},j=()=>{w(),f(!1)},z=()=>{w(),f(!1)},G=async s=>{await I(s)},a=async s=>{await _(s)},p=async s=>{s.id=E&&E.id?E.id:0,w(),f(!1);const c=L.loading("\u6B63\u5728\u6DFB\u52A0/\u66F4\u65B0");try{return s.id===0?await G(s):await a(s),c(),L.success("\u64CD\u4F5C\u6210\u529F"),B(),!0}catch{return c(),L.error("\u64CD\u4F5C\u5931\u8D25\u8BF7\u91CD\u8BD5\uFF01"),!1}},N=async s=>{var i;const c=L.loading("\u6B63\u5728\u5220\u9664");if(!s)return!0;try{const ae=((i=s.map(re=>re.id))!=null?i:[]).join(",");return await v({ids:ae}),S(A(h({},d),{current:1})),c(),L.success("\u5220\u9664\u6210\u529F\uFF0C\u5373\u5C06\u5237\u65B0"),!0}catch{return c(),L.error("\u5220\u9664\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5"),!1}};function se(s){return e.createElement("a",h({},s),s.children)}const V=te(se,r),Q=te(R,r),oe=[{title:"\u89D2\u8272\u540D",dataIndex:"name",tip:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D"},{title:"\u89D2\u8272\u63CF\u8FF0",dataIndex:"comment",valueType:"textarea"},{title:o({id:"gloabal.tips.operation"}),dataIndex:"option",valueType:"option",render:(s,c)=>[e.createElement(V,{key:D.EDIT,operCode:D.EDIT,onClick:M=>{M.preventDefault(),O(c)}},"\u7F16\u8F91"),e.createElement(V,{key:D.DELETE,operCode:D.DELETE,onClick:M=>{M.preventDefault(),be.confirm({title:"\u5220\u9664\u89D2\u8272",content:"\u786E\u5B9A\u5220\u9664\u8BE5\u89D2\u8272\u5417\uFF1F",okText:"\u786E\u8BA4",cancelText:"\u53D6\u6D88",onOk:async()=>{await N([h({},c)]),k([]),B()}})}},"\u5220\u9664")]}];return e.createElement(Le,null,e.createElement(Ae,{headerTitle:"\u89D2\u8272\u7BA1\u7406",actionRef:g,rowKey:"id",options:{reload:!1},toolBarRender:()=>[e.createElement(Q,{type:"primary",key:"primary",onClick:q,operCode:D.ADD},ee.get(D.ADD))],request:void 0,dataSource:n,columns:oe,pagination:d,onChange:(s,c,i)=>{S(s)},rowSelection:{onChange:(s,c)=>{k(c)}},search:{defaultCollapsed:!1,optionRender:({searchText:s,resetText:c},{form:i})=>[e.createElement(R,{key:"search",type:"primary",onClick:()=>{console.log("search submit"),C(i==null?void 0:i.getFieldsValue())}},s),e.createElement(R,{key:"reset",onClick:()=>{i==null||i.resetFields()}},c)]}}),(m==null?void 0:m.length)>0&&e.createElement(Ke,{extra:e.createElement("div",null,e.createElement(Z,{id:"app.role.chosen",defaultMessage:"\u5DF2\u9009\u62E9"})," ",e.createElement("a",{style:{fontWeight:600}},m.length)," ",e.createElement(Z,{id:"app.role.item",defaultMessage:"\u9879"}))},e.createElement(Q,{type:"primary",key:"primary",onClick:async()=>{await N(m),k([]),B()},operCode:D.DELETE},ee.get(D.DELETE)),","),b?e.createElement(Oe,{done:F,current:E,visible:b,onDone:j,onCancel:z,onSubmit:p}):null)};export{ut as default};
